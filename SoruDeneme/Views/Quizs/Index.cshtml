@model IEnumerable<SoruDeneme.Models.Quiz>

@{
    ViewData["Title"] = "Sınavlar";
    var role = Context.Session.GetString("UserRole"); // "Egitmen" / "Ogrenci"
}

<style>
    .page-scale {
        transform: scale(1.5);
        transform-origin: top center;
        width: 100%;
        margin-bottom: 150px;
    }
</style>

<div class="page-scale">
    <div class="container mt-4">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="display-6 fw-bold text-primary">SINAVLAR</h1>

            @if (role == "Egitmen")
            {
                <a asp-action="Create" class="btn btn-success">
                    + Yeni Sınav Oluştur
                </a>
            }
        </div>

        @* ✅ Öğrenci için kod girme alanı *@
        @if (role == "Ogrenci")
        {
            if (TempData["UnlockSuccess"] != null)
            {
                <div class="alert alert-success">@TempData["UnlockSuccess"]</div>
            }
            if (TempData["UnlockError"] != null)
            {
                <div class="alert alert-danger">@TempData["UnlockError"]</div>
            }

            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <div class="fw-bold mb-2">Kodlu Sınav Aç</div>

                    <form asp-action="UnlockByCode" method="post" class="d-flex gap-2">
                        @Html.AntiForgeryToken()
                        <input type="text"
                               name="accessCode"
                               class="form-control"
                               placeholder="Kod gir (örn: ABC123)"
                               autocomplete="off" />
                        <button type="submit" class="btn btn-primary">
                            Kodu Aç
                        </button>
                    </form>

                    <div class="text-muted small mt-2">
                        Kod doğruysa sınav listede görünür ve başlatılabilir.
                    </div>
                </div>
            </div>
        }

        <table class="table table-hover shadow-sm border rounded">
            <thead class="table-light">
                <tr>
                    <th>Sınav Adı</th>
                    <th>Tür / Kategori</th>
                    <th class="text-end">İşlemler</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.QuizName</td>
                        <td>@(item.Genre ?? "-")</td>
                        <td class="text-end">

                            @if (role == "Ogrenci")
                            {
                                <a asp-action="Solve"
                                   asp-route-quizId="@item.Id"
                                   asp-route-order="0"
                                   class="btn btn-sm btn-success me-1">
                                    Başlat
                                </a>
                            }

                            @if (role == "Egitmen")
                            {
                                @* ✅ Sorular artık Create Wizard içinde *@
                                <a asp-action="Create"
                                   asp-route-id="@item.Id"
                                   class="btn btn-sm btn-primary me-1">
                                    Soruları Düzenle
                                </a>

                                <a asp-action="Scoreboard"
                                   asp-route-quizId="@item.Id"
                                   class="btn btn-sm btn-dark me-1">
                                    Skorlar
                                </a>

                                <a asp-action="Edit"
                                   asp-route-id="@item.Id"
                                   class="btn btn-sm btn-warning text-white me-1">
                                    Düzenle
                                </a>

                                <a asp-action="Details"
                                   asp-route-id="@item.Id"
                                   class="btn btn-sm btn-info text-white me-1">
                                    Detaylar
                                </a>

                                <a asp-action="Delete"
                                   asp-route-id="@item.Id"
                                   class="btn btn-sm btn-danger">
                                    Sil
                                </a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        @if (string.IsNullOrEmpty(role))
        {
            <div class="alert alert-warning mt-3">
                Devam etmek için giriş yapmalısınız.
            </div>
        }
    </div>
</div>
