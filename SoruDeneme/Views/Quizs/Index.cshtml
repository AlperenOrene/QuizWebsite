@model IEnumerable<SoruDeneme.Models.Quiz>

@{
    ViewData["Title"] = "Sınavlar";
    var role = Context.Session.GetString("UserRole"); // Egitmen / Ogrenci

    var bgClass = role == "Egitmen"
        ? "page-teacher"
        : role == "Ogrenci"
            ? "page-student"
            : "page-guest";
}

<style>
    .page-teacher {
        min-height: 100vh;
        background: linear-gradient(135deg, #0d6efd, #cfe2ff);
        padding: 60px 0;
    }

    .page-student {
        min-height: 100vh;
        background: linear-gradient(135deg, #198754, #d1e7dd);
        padding: 60px 0;
    }

    .page-guest {
        min-height: 100vh;
        background: #f8f9fa;
        padding: 60px 0;
    }

    .card {
        border-radius: 16px;
        border: none;
    }

    table {
        background: #fff;
        border-radius: 14px;
        overflow: hidden;
    }

    th {
        text-transform: uppercase;
        font-size: 13px;
        letter-spacing: .05em;
    }

    .actions-wrap {
        display: inline-flex;
        gap: .4rem;
        flex-wrap: nowrap;
        justify-content: flex-end;
    }

    .badge-soft {
        border: 1px solid #ddd;
        border-radius: 999px;
        padding: 4px 12px;
        font-size: 12px;
        background: #f8f9fa;
    }
</style>

<div class="@bgClass">
    <div class="container">

        <!-- HEADER -->
        <div class="card shadow-sm mb-4 p-4">
            <div class="d-flex justify-content-between align-items-center">

                <h1 class="fw-bold mb-0">📚 Sınavlar</h1>

                <div class="d-flex gap-2">

                    @if (role == "Egitmen")
                    {
                        <a asp-controller="Home"
                           asp-action="EgitmenHome"
                           class="btn btn-outline-secondary btn-lg">
                            ← Panele Dön
                        </a>

                        <a asp-action="Create" class="btn btn-success btn-lg">
                            + Yeni Sınav
                        </a>
                    }

                    @if (role == "Ogrenci")
                    {
                        <a asp-controller="Home"
                           asp-action="OgrenciHome"
                           class="btn btn-outline-secondary btn-lg">
                            ← Panele Dön
                        </a>
                    }

                </div>
            </div>
        </div>

        <!-- STUDENT UNLOCK -->
        @if (role == "Ogrenci")
        {
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">🔑 Kodlu Sınav Aç</h5>

                    <form asp-action="UnlockByCode" method="post" class="d-flex gap-2">
                        @Html.AntiForgeryToken()
                        <input type="text"
                               name="accessCode"
                               class="form-control"
                               placeholder="Sınav Kodu"
                               maxlength="20"
                               autocomplete="off" />

                        <button class="btn btn-primary">Aç</button>
                    </form>

                    @if (TempData["UnlockSuccess"] != null)
                    {
                        <div class="alert alert-success mt-3">@TempData["UnlockSuccess"]</div>
                    }

                    @if (TempData["UnlockError"] != null)
                    {
                        <div class="alert alert-danger mt-3">@TempData["UnlockError"]</div>
                    }
                </div>
            </div>
        }

        <!-- TABLE -->
        <div class="card shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Sınav</th>
                                <th>Kategori</th>
                                <th>Süre</th>
                                <th>Erişim</th>
                                <th class="text-end">İşlemler</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="fw-bold">@item.QuizName</td>
                                    <td>@(item.Genre ?? "-")</td>
                                    <td>@(item.TimeLimitMinutes > 0 ? item.TimeLimitMinutes + " dk" : "-")</td>
                                    <td>
                                        <span class="badge-soft">
                                            @(item.IsPublic ? "Public" : "Kodlu")
                                        </span>
                                    </td>

                                    <td class="text-end">
                                        <div class="actions-wrap">

                                            @if (role == "Ogrenci")
                                            {
                                                <a asp-action="Solve"
                                                   asp-route-quizId="@item.Id"
                                                   asp-route-order="0"
                                                   class="btn btn-success btn-sm">
                                                    Başlat
                                                </a>
                                            }

                                            @if (role == "Egitmen")
                                            {
                                                <a asp-action="Create" asp-route-id="@item.Id" class="btn btn-primary btn-sm">Sorular</a>
                                                <a asp-action="Scoreboard" asp-route-quizId="@item.Id" class="btn btn-dark btn-sm">Skor</a>
                                                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-sm text-white">Düzenle</a>
                                                <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm">Sil</a>
                                            }
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

