@model SoruDeneme.Models.ViewModels.ManageQuizViewModel

@{
    ViewData["Title"] = "Quiz Yönetimi";
}

<style>
    .qimg {
        max-width: 320px;
        max-height: 220px;
        object-fit: contain;
        border: 1px solid #eee;
        border-radius: 10px;
        padding: 6px;
        background: white;
    }
</style>

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 class="mb-1">@Model.Quiz.QuizName</h2>
            <div class="text-muted">
                Tür: <strong>@(Model.Quiz.Genre ?? "-")</strong>
                | Süre: <strong>@(Model.Quiz.TimeLimitMinutes?.ToString() ?? "Süresiz")</strong>
                | Eriþim: <strong>@(Model.Quiz.IsPublic ? "Public" : "Kodlu")</strong>
                @if (!Model.Quiz.IsPublic)
                {
                    <span>| Kod: <strong>@Model.Quiz.AccessCode</strong></span>
                }
            </div>
        </div>

        <div class="d-flex gap-2">
            <a asp-action="Edit" asp-route-id="@Model.Quiz.Id" class="btn btn-warning text-white">Quiz Düzenle</a>
            <a asp-action="Index" class="btn btn-secondary">Listeye Dön</a>
        </div>
    </div>

    @if (TempData["ManageSuccess"] != null)
    {
        <div class="alert alert-success">@TempData["ManageSuccess"]</div>
    }
    @if (TempData["ManageError"] != null)
    {
        <div class="alert alert-danger">@TempData["ManageError"]</div>
    }

    <div class="card shadow-sm mb-3">
        <div class="card-header bg-light">
            <strong>Sorular (Sadece Görüntüle / Sil)</strong>
            <div class="text-muted small mt-1">
                Not: Sorular artýk sadece "Quiz Oluþtur" ekranýnda eklenir.
            </div>
        </div>
        <div class="card-body">

            @if (Model.Quiz.Questions == null || !Model.Quiz.Questions.Any())
            {
                <div class="text-muted">Henüz soru eklenmedi.</div>
            }
            else
            {
                <table class="table table-sm align-middle">
                    <thead>
                        <tr>
                            <th style="width:70px;">No</th>
                            <th>Soru</th>
                            <th style="width:120px;" class="text-end">Ýþlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var q in Model.Quiz.Questions.OrderBy(x => x.QuestionNum))
                        {
                            <tr>
                                <td>@q.QuestionNum</td>
                                <td>
                                    <div class="fw-bold">@q.Text</div>
                                    @if (!string.IsNullOrEmpty(q.ImagePath))
                                    {
                                        <div class="mt-2">
                                            <img src="@q.ImagePath" class="qimg" />
                                        </div>
                                    }
                                    <div class="text-muted small mt-1">
                                        Doðru: <strong>@q.CorrectOption</strong>
                                    </div>
                                </td>
                                <td class="text-end">
                                    <form asp-action="DeleteQuestion" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@Model.Quiz.Id" />
                                        <input type="hidden" name="questionId" value="@q.Id" />
                                        <button type="submit" class="btn btn-sm btn-danger"
                                                onclick="return confirm('Bu soruyu silmek istiyor musun?');">
                                            Sil
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }

        </div>
    </div>
</div>
